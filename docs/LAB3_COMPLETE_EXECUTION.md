# Complete Lab 3 Execution Guide - With IO Pads

## ✅ Everything is Ready!

All files have been updated with **actual pad cell names** from your giolib045 library:
- ✅ IO wrapper module with real pad cells (PADDI, PADDO, PADVDD, etc.)
- ✅ IO placement file with all 29 signals organized
- ✅ Updated P&R script with IO pad LEF support
- ✅ Synthesis script for wrapper module
- ✅ Library setup includes giolib045.lef

---

## Quick Start - Full IO Pad Implementation

### Step 1: Synthesize the IO Wrapper (10-15 min)

```bash
cd /home/akitha/Desktop/spi_master_controller/work
genus -f ../scripts/synthesis_spi_with_pads.tcl | tee ../log/synthesis_with_pads.log
```

**What this does:**
- Reads both `spi_master.v` (core) and `spi_master_chip.v` (wrapper)
- Elaborates the wrapper as top-level
- Synthesizes with IO pad cells included
- Generates netlist: `output/spi_master_chip.v`
- Creates reports in `report/synthesis_with_pads_*.log`

**Expected results:**
- Area will be larger (includes pad cells: 60um x 240um each)
- Timing should still meet 50MHz constraint
- About 29 input pads + 23 output pads + 6 power pads + 4 corners = ~62 pad cells

---

### Step 2: Place & Route with IO Pads (20-30 min)

```bash
cd /home/akitha/Desktop/spi_master_controller/work
innovus -files ../scripts/place_route_with_io_auto.tcl | tee ../log/pr_with_pads.log
```

**What this does:**
- Imports wrapper netlist with pad instances
- Loads IO placement file (`spi_master.io`)
- Places pads around the perimeter per `.io` file
- Creates floorplan with core-to-IO margins
- Performs place & route with pad ring
- Exports GDS with complete chip (core + pads)

**Configuration already set:**
- `USE_IO_WRAPPER = 1` (uses wrapper)
- Core utilization: 30%
- IO margins: 150um
- Includes `giolib045.lef` for pad cells

---

## Expected Layout

```
+---------------------------------------------------------------+
|  Corner                    TOP PADS                   Corner |
|  [UL]      [rx_valid] [busy] [sclk] [mosi] [ss_n]     [UR]  |
|                       [VDDIO] [VDD] [VSS]                    |
|                                                               |
| L  [VSS]                                           [rx_0]  R |
| E  [clk]                   CORE AREA              [rx_1]  I |
| F  [reset]                (30% util)               [rx_2]  G |
| T  [start]                                         [rx_3]  H |
|    [cpol]                                          [rx_4]  T |
| P  [cpha]                                          [rx_5]    |
| A  [div0]                                          [rx_6]  P |
| D  [div1]                                          [rx_7]  A |
| S  [VDD]                                           [VSSIO] D |
|                                                              S|
|  Corner      [tx_0-7] [miso] (BOTTOM PADS)        Corner   |
|  [LL]                                               [LR]    |
+---------------------------------------------------------------+
```

---

## Actual Pad Cells Used

From giolib045.lef (verified in your library):

| Function | Cell Name | Ports | Count |
|----------|-----------|-------|-------|
| Input pads | `PADDI` | PAD, Y, VDD, VSS, VDDIOR, VSSIOR | 19 |
| Output pads | `PADDO` | PAD, A, VDD, VSS, VDDIOR, VSSIOR | 13 |
| Core VDD | `PADVDD` | PAD | 2 |
| Core VSS | `PADVSS` | PAD | 2 |
| IO VDD | `PADVDDIOR` | PAD | 1 |
| IO VSS | `PADVSSIOR` | PAD | 1 |
| Corners | `padIORINGCORNER` | (none) | 4 |
| **Total** | | | **42 cells** |

Each pad: 60um × 240um

---

## Signal Distribution

### Inputs (19 pads - PADDI):
- System: clk, reset (2)
- Control: start, cpol, cpha, clk_div[1:0] (5)
- Data: tx_data[7:0] (8)
- SPI: miso (1)
- DFT: SE, scan_in, scan_out (3) - *if DFT enabled*

### Outputs (13 pads - PADDO):
- Data: rx_data[7:0] (8)
- Status: rx_valid, busy (2)
- SPI: sclk, mosi, ss_n (3)

### Power (6 pads):
- Core power: VDD (2), VSS (2)
- IO power: VDDIOR (1), VSSIOR (1)

### Corners (4 pads):
- padIORINGCORNER at all 4 corners

---

## Files Created/Updated

```
input/
├── rtl/
│   ├── spi_master.v                    # Original core (unchanged)
│   └── spi_master_chip.v               # ✅ UPDATED with real pad cells
├── spi_master.io                       # ✅ IO placement file
└── libs/gsclib045/
    └── lef/giolib045.lef               # ✅ Already exists (IO pad library)

scripts/
├── setup_spi.tcl                       # ✅ UPDATED: includes giolib045.lef
├── synthesis_spi_with_pads.tcl         # ✅ NEW: synthesizes wrapper
└── place_route_with_io_auto.tcl        # ✅ UPDATED: USE_IO_WRAPPER=1

output/
├── spi_master_chip.v                   # Generated by synthesis
├── spi_master_chip.sdc                 # Generated by synthesis
└── spi_master_with_io.gds              # Generated by P&R
```

---

## Verification Checklist

After P&R completes, check:

- [ ] **Floorplan**: Core area with 150um margins for pad ring
- [ ] **IO placement**: All pads placed per `.io` file around perimeter
- [ ] **Corner cells**: 4 corners properly placed
- [ ] **Power pads**: Distributed around ring (2 VDD, 2 VSS, 1 VDDIO, 1 VSSIO)
- [ ] **Signal pads**: 19 inputs + 13 outputs = 32 signal pads
- [ ] **Timing**: Setup WNS > 0, Hold WNS > 0
- [ ] **DRC**: 0 violations
- [ ] **Connectivity**: All pads connected to core signals
- [ ] **GDS export**: Successfully created

---

## Troubleshooting

### If synthesis fails with "cell not found":
The pad cell names are correct (verified from your giolib045.lef). Check that:
- `giolib045.lef` is in library search path
- `setup_spi.tcl` includes giolib045.lef

### If IO placement fails:
- Instance names in `.io` file must match wrapper instantiation names
- All names verified and match

### If power routing fails:
- Power pads automatically connect to VDD/VSS/VDDIOR/VSSIOR
- Use `sroute` command with `-padPinUse power`

---

## Alternative: Core-Only Mode

If you want to run without pads (just reserved area):

1. Edit `scripts/place_route_with_io_auto.tcl`
2. Change line 13: `set USE_IO_WRAPPER 0`
3. Run P&R as normal

This will:
- Use `spi_master.v` (core only)
- Reserve 150um margins
- Place regular I/O pins (not physical pads)
- Works without synthesizing wrapper

---

## Summary

✅ **All pad cells identified and updated**
✅ **Library files exist and are included**  
✅ **Scripts configured for full pad implementation**  
✅ **Ready to synthesize and run P&R**

**Your implementation uses actual gsclib045 IO pad cells** from giolib045.lef:
- Input: PADDI (PAD → Y)
- Output: PADDO (A → PAD)
- Power: PADVDD, PADVSS, PADVDDIOR, PADVSSIOR
- Corner: padIORINGCORNER

**Just run the two commands above** and you'll have a complete chip layout with IO pad ring!
